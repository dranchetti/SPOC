/*! SPOC 20-08-2015 */
!function(a,b,c,d,e){"use strict";c.Utils={},c.SP={},c.Yam={},c.Utils.Arrays={},c.Utils.Arrays.findByProperty=function(a,b,c){var d;for(d=0;d<a.length;d++)if(a[d][b]===c)return a[d];return!1},c.Utils.Conversion={},c.Utils.Conversion.objToQueryString=function(a){var b="";for(var c in a)b+="&$"+c+"="+a[c];return b},c.Utils.SP={},c.Utils.SP.getListItemType=function(a){return"SP.Data."+a[0].toUpperCase()+a.substring(1)+"ListItem"},c.Utils.Storage={},c.Utils.Storage.storageAvailable=function(){return"undefined"!=typeof Storage},c.Utils.Storage.set=function(a,b,d){if(c.Utils.Storage.storageAvailable()){var e=d?localStorage:sessionStorage;e.setItem(a,b===Object(b)?JSON.stringify(b):b)}},c.Utils.Storage.get=function(a,b){if(c.Utils.Storage.storageAvailable()){var d=b?localStorage:sessionStorage;return JSON.parse(d.getItem(a))}return null},c.Utils.Storage.remove=function(a,b){if(c.Utils.Storage.storageAvailable()){b?localStorage:sessionStorage;localStorage.removeItem(a)}},c.Utils.Storage.getCookies=function(a){a+="=";for(var c=b.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0===e.indexOf(a))return e.substring(a.length,e.length)}return!1},c.Utils.Storage.setCookies=function(a,c,d){var e;if(d){var f=new Date;f.setTime(f.getTime()+24*d*60*60*1e3),e="; expires="+f.toGMTString()}else e="";b.cookie=a+"="+c+"; "+e},c.Utils.Storage.removeCookies=function(a){c.Utils.Storage.setCookies(a,"",-1)},c.Tpl={},c.Tpl.getProperty=function(a,b){var c,d=a.split("."),e=d.length,f=b||this;for(c=0;e>c;c++)f=f[d[c]];return f},c.Tpl.render=function(a,b){var d=/{{(.*?)}}/g,e=a.match(d);if(e&&e.length)for(var f=0,g=e.length;g>f;f++)a=a.replace(new RegExp(e[f],"g"),c.Tpl.getProperty(e[f].replace(/{{|}}/g,""),b));return a},c.Utils.Url={},c.Utils.Url.getQueryString=function(b,c){c=c?c.split("?")[1]:a.location.search.substring(1);for(var d=c.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(f[0]==b)return unescape(f[1])}},c.Utils.Yammer={},c.Utils.Yammer.formatFeedResponse=function(a){var b;for(b=0;b<a.messages.length;b++)a.messages[b].sender_type&&"user"===a.messages[b].sender_type&&(a.messages[b].user=c.Utils.Arrays.findByProperty(a.references,"id",a.messages[b].sender_id));return a.messages},c.Utils.Yammer.checkLogin=function(){var a=d.Deferred();return yam.getLoginStatus(function(b){b.authResponse?a.resolve(b):yam.platform.login(function(b){b&&a.resolve(b)})}),a},c.SP.Site=function(a){this.url=a?a:_spPageContextInfo.webAbsoluteUrl},c.SP.User=function(a){this.id=a?a:_spPageContextInfo.userId,this.loginName=a?a:_spPageContextInfo.userLoginName,this.isAdmin=a?!1:_spPageContextInfo.isSiteAdmin},c.Yam.User=function(b){a.yam||console.log("Please ensure that you have included Yammer SDK and added a valid Client Id"),this.id=b?b:"current"},c.Yam.Messages=function(b,c){a.yam||console.log("Please ensure that you have included Yammer SDK and added a valid Client Id"),this.feedId=b,this.feedType=c},c.SP.Site.prototype.ListItems=function(a){var b=this,e={};return e.query=function(e,f,g){var h=d.Deferred(),i=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/items",j=c.Utils.Storage.get("SPOCC-listitems"+a);return i+=e?"?"+c.Utils.Conversion.objToQueryString(e):"",j&&!f?h.resolve(j):d.ajax({type:"GET",url:i,dataType:"json",headers:{Accept:"verbose"},success:function(b){c.Utils.Storage.set("SPOCC-listitems"+a,b),h.resolve(b)},error:function(a){h.reject(a)}}),h.promise()},e.create=function(e){var f=d.Deferred(),g=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/items",h={__metadata:{type:c.Utils.SP.getListItemType(a)}};return settings&&d.extend(h,e),d.ajax({type:"POST",url:g,data:JSON.stringify(h),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d("#__REQUESTDIGEST").val(),"Content-Type":"application/json;odata=verbose"},success:function(a){f.resolve(a)},error:function(a){f.reject(a)}}),f.promise()},e.update=function(e,f){var g=d.Deferred(),h=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/items",i={__metadata:{type:c.Utils.SP.getListItemType(a)},BaseTemplate:100,Description:""};return settings&&d.extend(i,settings),d.ajax({type:"POST",url:h,data:JSON.stringify(i),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d("#__REQUESTDIGEST").val(),"Content-Type":"application/json;odata=verbose"},success:function(a){g.resolve(a)},error:function(a){g.reject(a)}}),g.promise()},e.uploadDocument=function(a,c){var e=d.Deferred(),f={};return c&&d.extend(f,c),f.url=b.url+"/_layouts/Upload.aspx?List="+a+"&IsDlg=1",f.dialogReturnValueCallback=Function.createDelegate(null,function(a){e.resolve(a)}),SP.UI.ModalDialog.showModalDialog(f),e.promise()},e},c.SP.Site.prototype.Lists=function(a){var b=this,e={};return e.query=function(e,f){var g=d.Deferred(),h=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/",i=c.Utils.Storage.get("SPOCC-list"+a);return h+=e?"?"+c.Utils.Conversion.convertObjToQueryString(e):"",i&&!f?g.resolve(i):d.ajax({type:"GET",url:h,dataType:"json",success:function(b){c.Utils.Storage.set("SPOCC-list"+a,b),g.resolve(b)},error:function(a){promise.reject(a)}}),g.promise()},e.create=function(a){var c=d.Deferred(),e={__metadata:{type:"SP.List"},BaseTemplate:100,Description:""};return a&&d.extend(e,a),d.ajax({type:"POST",url:b.url+"/_api/web/lists",data:JSON.stringify(e),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d("#__REQUESTDIGEST").val(),"Content-Type":"application/json;odata=verbose"},success:function(a){c.resolve(a)},error:function(a){promise.reject(a)}}),c.promise()},e},c.SP.User.prototype.Profile=function(){var a=this,b={},e="i:0%23.f|membership|";return b.query=function(b){var f=d.Deferred(),g=_spPageContextInfo.webAbsoluteUrl,h=c.Utils.Storage.set("SPOCC-Users-"+a.id);return h&&!b?f.resolve(h):(g+="/_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v=%27"+e+a.loginName+"%27",d.ajax({type:"GET",url:g,dataType:"json",success:function(b){c.Utils.Storage.set("SPOCC-Users-"+a.id,b),f.resolve(b)}})),f.promise()},b},c.Yam.Messages=function(){var a=this,b={},e="messages.json";return feedId&&feedType&&(e="messages/"+a.feedType=="group"?"in_group":"from_user/"+a.feedId+".json"),b.query=function(b,f){var g=d.Deferred(),h=c.Utils.Storage.get("SPOCC-yammessage"+a.feedId+a/feedType);return h&&!f?g.resolve(h):c.Utils.Yammer.checkLogin().then(function(){yam.platform.request({url:e,method:"GET",data:b?b:null,success:function(a){a=c.Utils.Yammer.formatFeedResponse(a),c.Utils.Storage.set("SPOCC-yammessage"+feedId+feedType,a),g.resolve(a)},error:function(a){g.reject(a)}})}),g},b},c.Yam.User.prototype.Profile=function(){var a=this,b={};return b.query=function(b,e){var f=d.Deferred(),g=c.Utils.Storage.get("SPOCC-yamuser"+a.id);return g&&!e?f.resolve(g):c.Utils.Yammer.checkLogin().then(function(){yam.platform.request({url:"users/"+a.id+".json",method:"GET",data:b?b:null,success:function(b){c.Utils.Storage.set("SPOCC-yamuser"+a.id,b),f.resolve(b)},error:function(a){f.reject(a)}})}),f},b}}(window,document,window.SPOC=window.SPOC||{},jQuery);