/*! SPOC 27-07-2015 */
!function(a,b,c,d,e){"use strict";c.Utils={},c.SPSite=null,c.Yam=null,c.Utils.Arrays={},c.Utils.Arrays.findByProperty=function(a,b,c){var d;for(d=0;d<a.length;d++)if(a[d][b]===c)return a[d];return!1},c.Utils.Conversion={},c.Utils.Conversion.objToQueryString=function(a){var b="";for(var c in a)b+="&$"+c+"="+a[c];return b},c.Utils.SP={},c.Utils.SP.getListItemType=function(a){return"SP.Data."+a[0].toUpperCase()+a.substring(1)+"ListItem"},c.Utils.Storage={},c.Utils.Storage.storageAvailable=function(){return"undefined"!=typeof Storage},c.Utils.Storage.set=function(a,b,d){if(c.Utils.Storage.storageAvailable()){var e=d?localStorage:sessionStorage;e.setItem(a,b===Object(b)?JSON.stringify(b):b)}},c.Utils.Storage.get=function(a,b){if(c.Utils.Storage.storageAvailable()){var d=b?localStorage:sessionStorage;return JSON.parse(d.getItem(a))}return null},c.Utils.Storage.remove=function(a,b){if(c.Utils.Storage.storageAvailable()){b?localStorage:sessionStorage;localStorage.removeItem(a)}},c.Tpl={},c.Tpl.getProperty=function(a,b){var c,d=a.split("."),e=d.length,f=b||this;for(c=0;e>c;c++)f=f[d[c]];return f},c.Tpl.render=function(a,b){var d=/{{(.*?)}}/g,e=a.match(d);if(e&&e.length)for(var f=0,g=e.length;g>f;f++)a=a.replace(new RegExp(e[f],"g"),c.Tpl.getProperty(e[f].replace(/{{|}}/g,""),b));return a},c.Utils.Yammer={},c.Utils.Yammer.formatFeedResponse=function(a){var b;for(b=0;b<a.messages.length;b++)a.messages[b].sender_type&&"user"===a.messages[b].sender_type&&(a.messages[b].user=c.Utils.Arrays.findByProperty(a.references,"id",a.messages[b].sender_id));return a.messages},c.SPSite=function(a){this.url=a?a:_spPageContextInfo.webAbsoluteUrl},c.Yam=function(){a.yam||console.log("Please ensure that you have included Yammer SDK and added a valid Client Id")},c.SPSite.prototype.ListItems=function(a){var b=this,e={};return e.query=function(e,f,g){var h=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/items",i=c.Utils.Storage.get("SPOCC-listitems"+a);return h+=e?"?"+c.Utils.convertObjToQueryString(e):"",i&&!f?i:d.ajax({type:"GET",url:h,dataType:"json",headers:{Accept:"verbose"},complete:function(b){c.Utils.Storage.set("SPOCC-listitems"+a,b)}})},e.create=function(e){var f=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/items",g={__metadata:{type:c.Utils.SP.getListItemType(a)}};return settings&&d.extend(g,e),d.ajax({type:"POST",url:f,data:JSON.stringify(g),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d("#__REQUESTDIGEST").val(),"Content-Type":"application/json;odata=verbose"}})},e.update=function(e,f){var g=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/items",h={__metadata:{type:c.Utils.SP.getListItemType(a)},BaseTemplate:100,Description:""};return settings&&d.extend(h,settings),d.ajax({type:"POST",url:g,data:JSON.stringify(h),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d("#__REQUESTDIGEST").val(),"Content-Type":"application/json;odata=verbose"}})},e["delete"]=function(a){var b=a.__metadata.uri;return settings&&d.extend(data,settings),d.ajax({type:"POST",url:b,data:JSON.stringify(data),headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":d("#__REQUESTDIGEST").val(),"If-Match":"*","Content-Type":"application/json;odata=verbose"}})},e.deleteById=function(e){var f=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/items",g={__metadata:{type:c.Utils.SP.getListItemType(a)}};return settings&&d.extend(g,settings),d.ajax({type:"POST",url:f,data:JSON.stringify(g),headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":d("#__REQUESTDIGEST").val(),"If-Match":"*","Content-Type":"application/json;odata=verbose"}})},e},c.SPSite.prototype.Lists=function(a){var b=this,e={};return e.query=function(e,f){var g=b.url+"/_api/lists/getByTitle%28%27"+a+"%27%29/",h=c.Utils.Storage.get("SPOCC-list"+a);return g+=e?"?"+c.Utils.Conversion.convertObjToQueryString(e):"",h&&!f?h:d.ajax({type:"GET",url:g,dataType:"json",complete:function(){c.Utils.Storage.set("SPOCC-list"+a,data)}})},e.create=function(a){var c={__metadata:{type:"SP.List"},BaseTemplate:100,Description:""};return a&&d.extend(c,a),d.ajax({type:"POST",url:b.url+"/_api/web/lists",data:JSON.stringify(c),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d("#__REQUESTDIGEST").val(),"Content-Type":"application/json;odata=verbose"}})},e},c.Yam.prototype.Auth=function(){var a={};return a.checkLogin=function(){var a=d.Deferred();return yam.getLoginStatus(function(b){b.authResponse?a.resolve(b):yam.platform.login(function(b){b&&a.resolve(b)})}),a},a},c.Yam.prototype.Messages=function(a,b){var e=this,f={},g="messages.json";return a&&b&&(g="messages/"+b=="group"?"in_group":"from_user/"+a+".json"),f.query=function(f,h){var i=d.Deferred(),j=c.Utils.Storage.get("SPOCC-yammessage"+a+b);return j&&!h?i.resolve(j):e.Auth.checkLogin().then(function(){yam.platform.request({url:g,method:"GET",data:f?f:null,success:function(d){d=c.Utils.Yammer.formatFeedResponse(d),c.Utils.Storage.set("SPOCC-yammessage"+a+b,d),i.resolve(d)},error:function(a){i.reject(a)}})}),i},f},c.Yam.prototype.User=function(a){var b=this,e={};return a=a?a:"current",e.query=function(e,f){var g=d.Deferred(),h=c.Utils.Storage.get("SPOCC-yamuser"+a);return h&&!f?g.resolve(h):b.Auth.checkLogin().then(function(){yam.platform.request({url:"users/"+a+".json",method:"GET",data:e?e:null,success:function(b){c.Utils.Storage.set("SPOCC-yamuser"+a,b),g.resolve(b)},error:function(a){g.reject(a)}})}),g},e}}(window,document,window.SPOC=window.SPOC||{},jQuery);